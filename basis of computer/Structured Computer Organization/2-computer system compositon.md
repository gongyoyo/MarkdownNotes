### 计算机系统组成

- 数字计算机是由处理器，存储器，输入/输出设备组成的内部互联系统

#### 2.1 处理器
- 总线： 总线是一些平行导线的集合，计算机用它来传递地址，数据和控制信号
- 中央处理器： 通过从主存储器中逐条进行取指令，分析指令和执行指令
    - 控制器： 负责从主存储器中取指令和确定指令类型
    - ALU: 执行指令
    - 内部存储器： 由寄存器组成
    - 程序计数器： 寄存器，指向下一条即将被取出执行的指令
    - 指令寄存器： 寄存器，存放着当前正在被执行的指令
- CPU的组成
    - 数据通路：寄存器（1-32个），ALU
    - 寄存器-内存指令，寄存器-寄存器指令
    - 数据通路周期：ALU将两个操作数进行运算并将结果存回的过程
- 指令执行
    - 取指-译码-执行
        - 从内存中取下一条指令到指令寄存器中
        - 将程序寄存器指向后面一条指令
        - 判断刚取到的指令类型
        - 若该执行用到内存单元，对该单元进行寻址
        - 必要时，从内存中取一个字到CPU的寄存器中
        - 执行指令
        - 返回第一步执行下一条指令
    - 解释器： 执行其他程序指令的程序
    - 复杂指令一般更快： 执行指令的步骤有时可以重叠，或用不同的硬件并行执行
    - 控制存储器：用来存放解释程序的快速只读存储器
- RISC和CISC
    - RISC：精简指令集计算机(Reduced Instruction Set Computer)
    - CISC：复杂指令集计算机(Complex Instruction Set Computer)
    - 兼容性
- 现代计算机设计原则
    - 所有指令可由硬件直接执行
        - 不要再由微指令解释一遍
    - 最大限度提高指令启动速度
        - MIPS：Millions Insturctions Per Sercond，每秒百万指令
        - 同时执行多条指令有可能提高性能，但要做许多记录来保证指令的正确执行顺序
    - 指令应易于译码
        - 判断指令要用到的资源的译码过程是严重影响指令启动速度的因素之一
    - 只允许读写内存指令访问内存
        - 访问内存需话费较长时间，且延时无法预测,并行执行
        - 最好只有LOAD和STORE指令可以访问内存,其他指令应只在寄存器中操作
    - 提供足够的寄存器
- 指令级并行
    - 指令级并行和处理器级并行
    - 指令流水线
        - 预取缓冲：寄存器，将指令从内存中预取出来并供需要时使用
        - 预取指令把指令执行分解成了取指令和实际执行指令两个过程，指令流水线把这个策略再往前推了一步
        - 取指单元，指令译码单元，取操作数单元，指令执行单元，回写单元
        - 指令流水线可以用指令时延（执行一条指令的时间）和处理器带宽（CPU的MIPS）来衡量
    - 超标量体系结构
        - 共用一个取指单元的双流水线, 并行执行的指令使用的资源不能冲突，且不能互相依赖各自的执行结果
        - 超标量常用来描述那些可在一个时钟周期内启动多条指令的处理器,指令启动的速度比执行的速度快很多，有多个功能单元
- 处理器级并行
    - 阵列计算机,阵列处理器,一个控制器，广播指令
    - 向量处理器,向量寄存器
    - 多处理器,多个CPU，公共内存,局部内存
    - 多计算机

#### 2.2 主存储器
- 存储器是计算机存放程序和数据的地方
- 存储位
    - 数字信息可以通过区分某些连续物理量的不同值来存储（如电压的高低），要区分的值越多，相邻值的差别就越小，存储器的可靠性就越低
    - BCD码（二－十进制码)：用４位二进制数表示十进制数，10种组合表示０－９，６种不用
- 内存编址
    - 存储器由许多可存放一段信息的单元（位置）组成，每个单元有一个编号，程序可以通过这个编号来访问这个单元，这个编号就是这个单元的地址
    - 地址位数与存储位：地址位数由存储器中需直接编址的单元的最大数目决定，而与每个单元有多少存储位无关
    - 字节，字：一般8位存储单元1字节，字节组合成字，32位字计算机每字有4个字节
- 字节顺序
    - 大端派（字节地址从左到右，从字节高的地址开始编排），小端派（字节地址从右到左，从字节低的地方开始编排）
    - 大小端交杂传输时很麻烦
- <font color='red'>纠错码</font>
    - 附加位（校验位）：一些内存中采用检错码或者纠错码,按特别的规定往每个内存字中加上一些附加位
    - 码字：包括ｍ位数据位和ｒ位校验位的ｎ位单元叫做ｎ位码字
    - 汉明码距（Hamming）:两个码字间不同的位数
    - 码距：所有合法码字中两个码距最小的码字中的码距
    - <font color='red'>检查ｄ位错，编码的码距要ｄ＋１，一个码字ｄ位出错纠无法成为另外一个合法码字；要纠ｄ位错，编码的码距需为２ｄ＋１,即使错了其中的ｄ位，它和原来的码字的码距还是比其他合法码距要小，这样纠可以确定它的合法码了</font>
    - 能纠正所有1位错的数据位m与校验位r关系为：(m+r+1)<= $2^r$
        - (n+1)*$2^m$ <= $2^n$, m+r=n
    - 汉明算法
        - m位数据位，r位校验位，字长m+r，位从1开始算，所有2的整数冥的位是校验位（1,2,4...）,其他数据位
        - 偶校验：每位校验位校验特定的位，其值使被校验的位中的1的个数为偶数
        - 第b位由第$b_1,b_2,...,b_j$位一起来校验，其中$b_1 + b_2 + ··· + b_j=b$
        - 发现出错位的方法：把所有出错的校验位的位号相加
- 高速缓存
    - 小容量高速存储器，大容量低速存储器
    - 小容量高速存储器被称为高速缓存,把读取频度最高的存储器内容保存在高速缓存中,CPU需要读取存储内容时，现在高速缓存中找
    - 局部性原理：单位时间片内，CPU对存储器的访问总是局限在存储器的一小部分中;访问存储器的某个字后，将该字和它相邻单元从低速大容量存储系统取到高速缓存中
    - 命中率：$h = \frac{(k-1)}{k}$; 缺失率：$1-h$
    - 平均访问时间：c表示访问一次高速缓存的时间，m表示访问一次主存储器的时间，h表示命中率
    $$平均访问时间=c + (1-h)m$$
    - cache块（cache line）:把主存储器和高速缓存分为固定大小的块
    - 整体缓存：指令和数据共享同一高速缓存
    - 分体缓存(哈佛结构)：指令用一个高速缓存而数据用另一个
        - 支持并行访问
        - 流水线的应用
- 内存封装及其类型
    - 内存都是以芯片位单位制造，销售和安装的
    - 单面接入内存组件(Single Inline Memory Module, SIMM)和双面接入内存组件(Dual Inline Memory Module, DIMM)
    - 小型DIMM(Small Outline..., SO-DIMM):一般用于笔记本
    - 内存平均出错率很低，一般可以省略检错和纠错位

#### 2.3 辅助存储器
- 层次存储结构
    - 寄存器->高速缓存->主存储器->磁盘存储器->磁带，光盘
- 磁盘
    - 当磁头中有正负电流通过时，就可磁化磁头(有空气垫)正下方的的磁盘表面，根据电流的极性不同，使磁性颗粒朝左或朝右偏转；当磁头通过磁性区域时，将被感应出正电流或负电流
    - 磁道：磁盘旋转一周后写入磁盘的数据位形成的环形
        - 扇区:大小一般一样
            - 前导区，数据区，纠错码，隔离带
    - 磁盘臂
    - 性能：寻道，旋转延时
    - 磁盘控制器:接受软件发出的命令，控制磁盘臂的运动，发现和纠正错误，字节数据的相互转换，扇区缓冲，重新映像坏扇区
- 软盘(磁碟)
    - 磁头和盘面直接接触，不进行数据读写时，PC机收回磁头，并停止盘面旋转
- IDE(Integrated Drive Electronic, 集成驱动器电路)盘
    - BIOS(Basic Input Output System，基本输入/输出系统)
    - EIDE(Extend IDE)
- SCSI(Small Computer System Interface,小型计算机系统接口)盘
- RAID（Redundant Array of Independent(Inexpensive,廉价的) Disks,独立磁盘的冗余阵列）盘,SLED(Single Large Expensive Disk,单个昂贵大磁盘)

#### 2.4 输入/输出设备
- 总线
    - 直接内存访问（Direct Memory Access）
    - 总线仲裁器， 周期窃取
- 显示器
    + 显示存储器
- 通信设备
    + 调制解调器
    - 初始化测距